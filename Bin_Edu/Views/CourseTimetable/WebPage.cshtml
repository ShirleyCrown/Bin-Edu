@{
    Layout = "~/Views/Layouts/StudentLayout/LAyoutPage.cshtml";
}
<!-- Custom left-border course card colors -->
<style>
    .course-card {
        border-left-width: 6px;
        border-left-style: solid;
        background: rgba(0, 0, 0, 0.03);
        height: 100%;
    }

    .border-orange {
        border-left-color: #f57c00 !important;
    }

    .border-green {
        border-left-color: #388e3c !important;
    }

    .border-blue {
        border-left-color: #1976d2 !important;
    }

    .border-purple {
        border-left-color: #7b1fa2 !important;
    }

    .border-rose {
        border-left-color: #d81b60 !important;
    }


    .timetable-wrapper {
        width: 100%;
    }

    /* Header row */
    .timetable-day-header {
        display: flex;
        width: 100%;
        background: white;
        border-bottom: 1px solid #ccc;
        position: sticky;
        top: 0;
        z-index: 50;
    }

    /* Each header cell */
    .day-label {
        flex: 1;
        text-align: center;
        padding: 10px 0;
        font-weight: 600;
        border-right: 1px solid #eee;
    }

    .day-label:first-child {
        width: 70px;
        /* align with hour column */
        flex: none;
        border-right: 1px solid #ccc;
        background: #fafafa;
    }

    .timetable-container {
        display: flex;
        width: 100%;
        height: 700px;
        overflow-y: scroll;
        position: relative;
    }

    .timetable-hours {
        width: 70px;
        border-right: 1px solid #ccc;
        position: relative;
    }

    .hour {
        height: 60px;
        /* 60px = 1 hour → 1px per minute */
        font-size: 12px;
        color: #444;
    }

    .timetable {
        display: flex;
        flex: 1;
    }

    .day-column {
        flex: 1;
        border-right: 1px solid #eee;
        position: relative;
    }

    .event {
        position: absolute;
        left: 5px;
        right: 5px;
        border-left: 6px solid #1976d2;
        background: rgba(25, 118, 210, 0.12);
        padding: 6px;
        border-radius: 4px;
        font-size: 12px;
        overflow: hidden;
        cursor: pointer;
    }


    .course-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 2px 12px rgba(0, 0, 0, .2);
        transition: 0.2s;
    }
</style>


<div class="container py-4">

    <div>
        <h1 id="courseTitle" class="fw-bold display-5">Advanced JavaScript: From Fundamentals to Functional</h1>
    </div>

    <!-- FILTER BAR -->
    <div class="d-flex flex-column flex-md-row align-items-center border-top border-bottom py-3 mb-4">

        <div class="me-5">
            <input 
                type="date" 
                class="form-control" 
                name="CurrentDate" 
                id="CurrentDate" 
                onchange="handleSelectDate(event.target.value)"
            >
        </div>

        <div class="mt-3 mt-md-0 d-flex align-items-center gap-3">
            <button class="btn btn-primary" onclick="handleSelectToday()">Today</button>
        </div>

    </div>

    <input type="hidden" name="CourseId" id="CourseId" value="@ViewBag.CourseId" />

    <!-- TIMETABLE -->
    <div class="table-responsive">

        <div class="timetable-wrapper">

            <!-- DAY HEADER ROW -->
            <div class="timetable-day-header">
                <div class="day-label"></div> <!-- empty for hour column -->
                <div class="day-label">Monday</div>
                <div class="day-label">Tuesday</div>
                <div class="day-label">Wednesday</div>
                <div class="day-label">Thursday</div>
                <div class="day-label">Friday</div>
                <div class="day-label">Saturday</div>
                <div class="day-label">Sunday</div>
            </div>

            <div class="timetable-container">
                <div class="timetable-hours">
                    <!-- Hour markers -->
                    <div class="hour">07:00</div>
                    <div class="hour">08:00</div>
                    <div class="hour">09:00</div>
                    <div class="hour">10:00</div>
                    <div class="hour">11:00</div>
                    <div class="hour">12:00</div>
                    <div class="hour">13:00</div>
                    <div class="hour">14:00</div>
                    <div class="hour">15:00</div>
                    <div class="hour">16:00</div>
                    <div class="hour">17:00</div>
                    <div class="hour">18:00</div>
                </div>

                <div class="timetable">
                    <div class="day-column" id="Monday"></div>
                    <div class="day-column" id="Tuesday"></div>
                    <div class="day-column" id="Wednesday"></div>
                    <div class="day-column" id="Thursday"></div>
                    <div class="day-column" id="Friday"></div>
                    <div class="day-column" id="Saturday"></div>
                    <div class="day-column" id="Sunday"></div>
                </div>
            </div>
        </div>

    </div>
</div>



<script>

    let selectedDate = ``;

    async function fetchMyCourseTimetable(selectedDateValue) {

        const dayColumns = document.querySelectorAll(".day-column");
        const courseTitleElement = document.getElementById("courseTitle");
        const courseId = document.getElementById("CourseId").value;

        dayColumns.forEach(e => e.innerHTML = '');

        try {

            const response = await axios.get(`/get-my-course-timetable/${courseId}`, {
                params: {
                    "selected_date": selectedDateValue
                }
            });

            const responseData = response.data.data;

            courseTitleElement.innerText = responseData.courseTitle;

            console.log(dayColumns)

            for (let i = 0; i < responseData.timetables.length; i++) {
                addEvent(
                    responseData.timetables[i].dayOfWeek,
                    responseData.teachingTeacherName,
                    responseData.timetables[i].startTime.substring(0, 5),
                    responseData.timetables[i].endTime.substring(0, 5),
                    "#1976d2"
                );
            }

        }
        catch (ex) {
            console.log(ex);
        }

    }

    
    function addEvent(dayId, instructor, startTime, endTime, color) {

        // Convert "HH:MM" → minutes since start of day (07:00 = 0)
        const base = 7 * 60;
        const toMinutes = t => {
            const [h, m] = t.split(":").map(Number);
            return h * 60 + m;
        };

        const start = toMinutes(startTime) - base;
        const end = toMinutes(endTime) - base;
        const duration = end - start;

        const event = document.createElement("div");
        event.className = "event";
        event.style.top = start + "px";
        event.style.height = duration + "px";
        event.style.borderLeftColor = color;

        event.innerHTML = `
                <small>${instructor}</small><br>
                <small>${startTime} - ${endTime}</small>
            `;

        document.getElementById(dayId).appendChild(event);
    }

    function handleSelectDate(selectedDateValue) {
        fetchMyCourseTimetable(selectedDateValue)
    }

    function handleSelectToday() {

        const currentDateInput = document.getElementById("CurrentDate");

        const today = new Date();

        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const dd = String(today.getDate()).padStart(2, '0');

        let selectedDate = `${yyyy}-${mm}-${dd}`;

        currentDateInput.value = selectedDate;
        
        fetchMyCourseTimetable(selectedDate)
    }

    document.addEventListener('DOMContentLoaded', () => {

        const today = new Date();

        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const dd = String(today.getDate()).padStart(2, '0');

        let selectedDate = `${yyyy}-${mm}-${dd}`;


        fetchMyCourseTimetable(selectedDate);
    })
</script>